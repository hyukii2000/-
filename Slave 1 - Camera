import bluetooth
import time
import picamera

# 블루투스 통신 설정
server_socket = bluetooth.BluetoothSocket(bluetooth.RFCOMM)
port = 1
server_socket.bind(("", port))
server_socket.listen(1)

# 블루투스 연결 대기
client_socket, client_info = server_socket.accept()
print("Accepted connection from ", client_info)

# 카메라 설정
camera = picamera.PiCamera()
camera.resolution = (640, 480)
camera.framerate = 30

# 무한 루프로 이미지 촬영 및 전송
try:
    while True:
        # 이미지 촬영
        camera.capture("image.jpg")

        # 이미지 파일을 열고 블루투스로 전송
        with open("image.jpg", "rb") as image_file:
            image_data = image_file.read()
            client_socket.send(image_data)

        # 1초간 대기
        time.sleep(1)

except KeyboardInterrupt:
    # Ctrl+C를 누르면 프로그램 종료
    print("Interrupted")

finally:
    # 블루투스 연결 종료
    client_socket.close()
    server_socket.close()
