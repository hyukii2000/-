import cv2
import imutils
import numpy as np
import subprocess

# 비디오 스트리밍 설정
video_stream = cv2.VideoCapture(0)  # 웹캠이나 비디오 파일의 경로를 지정할 수 있습니다.
video_codec = cv2.VideoWriter_fourcc(*"XVID")  # 비디오 코덱 설정 (여기서는 XVID 사용)

# VLC 플레이어 실행 설정
vlc_cmd = ['cvlc', '-']  # 비디오를 stdin으로부터 읽도록 VLC 실행 명령

# VLC 프로세스 시작
vlc_process = subprocess.Popen(vlc_cmd, stdin=subprocess.PIPE)

while True:
    # 비디오 프레임 읽기
    ret, frame = video_stream.read()
    if not ret:
        break

    # 프레임 인코딩
    encoded_frame = cv2.imencode('.jpg', frame)[1]
    frame_data = np.array(encoded_frame).tostring()

    # 디코딩된 프레임 전송
    vlc_process.stdin.write(frame_data)
    vlc_process.stdin.flush()

# 비디오 스트리밍 및 VLC 종료
video_stream.release()
vlc_process.stdin.close()
vlc_process.wait()
