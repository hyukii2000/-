# ImageHub 초기화
image_hub = imagezmq.ImageHub()

# VLC Player로부터의 연결 요청 대기
sender = image_hub.zmq_socket.getsockopt_string(socket.SNDHWM)
image_hub.zmq_socket.setsockopt_string(socket.SNDHWM, sender)

# 무한 루프
while True:
    # 비디오 프레임 읽기
    frame = vs.read()

    # 프레임을 ImageHub에 전송
    image_hub.send_image(socket.gethostname(), frame)

    # VLC Player로부터의 연결 수락
    image_hub.recv_image()

    # 수신한 이미지를 화면에 표시
    image_hub.send_reply(b'OK')

    # 'q' 키를 누르면 종료
    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

# 비디오 스트리밍 종료
vs.stop()
cv2.destroyAllWindows()
